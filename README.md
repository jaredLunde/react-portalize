<hr>
<div align="center">
  <h1 align="center">
    react-portalize
  </h1>
</div>

<p align="center">
  <a href="https://bundlephobia.com/result?p=react-portalize">
    <img alt="Bundlephobia" src="https://img.shields.io/bundlephobia/minzip/react-portalize?style=for-the-badge&labelColor=24292e">
  </a>
  <a aria-label="Types" href="https://www.npmjs.com/package/react-portalize">
    <img alt="Types" src="https://img.shields.io/npm/types/react-portalize?style=for-the-badge&labelColor=24292e">
  </a>
  <a aria-label="Code coverage report" href="https://codecov.io/gh/jaredLunde/react-portalize">
    <img alt="Code coverage" src="https://img.shields.io/codecov/c/gh/jaredLunde/react-portalize?style=for-the-badge&labelColor=24292e">
  </a>
  <a aria-label="Build status" href="https://travis-ci.org/jaredLunde/react-portalize">
    <img alt="Build status" src="https://img.shields.io/travis/jaredLunde/react-portalize?style=for-the-badge&labelColor=24292e">
  </a>
  <a aria-label="NPM version" href="https://www.npmjs.com/package/react-portalize">
    <img alt="NPM Version" src="https://img.shields.io/npm/v/react-portalize?style=for-the-badge&labelColor=24292e">
  </a>
  <a aria-label="License" href="https://jaredlunde.mit-license.org/">
    <img alt="MIT License" src="https://img.shields.io/npm/l/react-portalize?style=for-the-badge&labelColor=24292e">
  </a>
</p>

<pre align="center">npm i react-portalize</pre>
<hr>

A convenient component for injecting elements into React Portals via DOM selectors. You may optionally choose to render
your portals on the server side as well :)

## Quick Start

```jsx harmony
import Portalize from 'react-portalize'


// renders 'Hello' into <div id='portals'/>
<Portalize container='#portals'>
  Hello
</Portalize>

// renders 'Hello' into all instances of <div class='portals'/>
<Portalize container='.portals'>
  Hello
</Portalize>

// renders 'Hello' into all instances of <section/>
<Portalize container='section'>
  Hello
</Portalize>

// renders 'Hello' into all instances of <div data-portalize="why not"/>
<Portalize container='div[data-portalize="why not"]'>
  Hello
</Portalize>
```

## API

### `<Portalize>`

- `container: string`

  - The DOM selector you'd like to render your children into
  - **default** `#portals`

- `children: React.ReactNode`

  - Anything React can render

- `server: boolean`

  - If you want to skip rendering this component on the server side you can do
    so with the `server={false}` flag. You don't need to worry about turning this
    off if you aren't rendering on the server with `renderPortalsToString`
  - **default** `true`

- `providers {provider: React.ReactProvider, value: any}[]`
  - Critically, this component will not work with portals in SSR that utilize context
    out of the box. This is because the children are never rendered into the
    virtual DOM tree on the server side. This hacky approach fixes that problem
    by creating your portals with `<Provider value={}/>` components wrapped
    around them. The providers supplied in the array are reduced from the
    right, so `[a, b, c]` renders as `<a><b><c/></b></a>`.
    ```js
    <Portalize providers={[{provider: YourProvider, value: YourProviderValue}]}>
      <YourConsumer>{(value) => JSON.stringify(value)}</YourConsumer>
    </Portalize>
    ```

## react-portalize/server

### `renderPortalsToString(html <string>)`

- Injects portals created within your App into their respective containers.
  You can provide either your entire `<!DOCTYPE html>` string here or
  alternatively just the React root generated by
  `ReactDOMServer.renderToString()`.

## SSR

### Example with React root as the entry point

```js
import {renderPortalsToString} from 'react-portalize/server'

function serverRenderer req, res, next() {
  const page = renderPortalsToString(
    ReactDOMServer.renderToString(<App/>)
  )

  res.set('Content-Type', 'text/html').send(`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <title>Hello world app</title>
    </head>
    <body>
      <div id="⚛️">${page}</div>
    </body>
    </html>
  `)
}
```

### Example with HTML root as the entry point

```js
import {renderPortalsToString} from 'react-portalize/server'

function serverRenderer(req, res, next) {
  const page = ReactDOMServer.renderToString(<App />)

  res.set('Content-Type', 'text/html').send(
    renderPortalsToString(`
      <!DOCTYPE html>
      <html lang="en">
      <head>
        <title>Hello world app</title>
      </head>
      <body>
        <div id="⚛️">${page}</div>
      </body>
      </html>
    `)
  )
}
```

## Note

You will receive a warning message in the console from `ReactDOM.hydrate()` in
"development" akin to `Did not expect server HTML to contain the text node "Hello" in <div>.`.
This is because `ReactDOM.hydrate()` does not expect your portals to be rendered
into the App. You can safely ignore this warning.

## LICENSE

MIT
